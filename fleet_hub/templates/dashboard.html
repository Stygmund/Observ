<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleet Hub - Observ Monitoring</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131820;
            --bg-card: rgba(20, 25, 36, 0.7);
            --bg-card-hover: rgba(25, 32, 48, 0.85);
            --border-color: rgba(99, 102, 241, 0.15);
            --border-glow: rgba(99, 102, 241, 0.3);

            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;

            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-error: #ef4444;
            --accent-info: #06b6d4;

            --glow-success: rgba(16, 185, 129, 0.3);
            --glow-warning: rgba(245, 158, 11, 0.3);
            --glow-error: rgba(239, 68, 68, 0.3);

            --font-display: 'Outfit', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;

            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-display);
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
        }

        /* Animated background grid */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            padding: 2rem;
            border-radius: 16px;
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg,
                transparent,
                var(--accent-primary) 20%,
                var(--accent-secondary) 50%,
                var(--accent-primary) 80%,
                transparent
            );
            animation: scanline 4s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 300;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 8px;
            font-size: 0.85rem;
            font-family: var(--font-mono);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-success);
            box-shadow: 0 0 12px var(--glow-success);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: var(--bg-card);
            padding: 0.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(20px);
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: var(--font-display);
            position: relative;
        }

        .tab:hover {
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .tab.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Fleet Grid */
        .fleet-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* VPS Cards */
        .vps-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .vps-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-success);
            transition: width 0.3s ease;
        }

        .vps-card.warning::before { background: var(--accent-warning); }
        .vps-card.error::before { background: var(--accent-error); }

        .vps-card:hover {
            border-color: var(--border-glow);
            background: var(--bg-card-hover);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .vps-card:hover::before {
            width: 100%;
            opacity: 0.05;
        }

        .vps-card.expanded {
            grid-column: 1 / -1;
            border-color: var(--accent-primary);
            box-shadow: 0 0 32px rgba(99, 102, 241, 0.2);
        }

        .vps-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .vps-title {
            flex: 1;
        }

        .vps-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .app-name {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-family: var(--font-mono);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .app-badge {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            background: rgba(99, 102, 241, 0.15);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--accent-primary);
            font-family: var(--font-mono);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .app-badge:hover {
            background: rgba(99, 102, 241, 0.25);
            border-color: var(--accent-primary);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.3);
        }

        .status-badge {
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-family: var(--font-mono);
        }

        .status-badge.healthy {
            background: rgba(16, 185, 129, 0.15);
            color: var(--accent-success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-badge.degraded {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-badge.critical {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-error);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .metric {
            background: rgba(15, 23, 42, 0.5);
            padding: 1rem;
            border-radius: 10px;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: var(--font-mono);
            line-height: 1;
        }

        .metric-unit {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-left: 0.2rem;
        }

        .metric-bar {
            margin-top: 0.5rem;
            height: 4px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .metric-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 2px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .last-seen {
            font-size: 0.85rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
            margin-top: 0.5rem;
        }

        /* Expanded Details */
        .vps-details {
            display: none;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            animation: expandDetails 0.3s ease-out;
        }

        .vps-card.expanded .vps-details {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        @keyframes expandDetails {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 1000px;
            }
        }

        .chart-container {
            background: rgba(15, 23, 42, 0.5);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .health-checks {
            background: rgba(15, 23, 42, 0.5);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(99, 102, 241, 0.1);
        }

        .health-check-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 3px solid var(--accent-success);
            font-family: var(--font-mono);
            font-size: 0.85rem;
        }

        .health-check-item.failed {
            border-left-color: var(--accent-error);
        }

        .health-check-time {
            color: var(--text-muted);
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .health-check-url {
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
            font-family: var(--font-mono);
            font-size: 0.8rem;
            word-break: break-all;
            pointer-events: none;
            user-select: text;
        }

        .health-check-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Logs Section */
        .logs-controls {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            margin-bottom: 1.5rem;
        }

        .control-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .search-box {
            flex: 1;
            padding: 0.75rem 1rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .filter-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-family: var(--font-mono);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .action-btn:hover {
            box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4);
            transform: translateY(-1px);
        }

        .secondary-btn {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid var(--border-color);
            color: var(--accent-primary);
        }

        .secondary-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            box-shadow: var(--shadow-sm);
        }

        /* Log Entries */
        .logs-container {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
        }

        .log-entry {
            padding: 1rem;
            border-bottom: 1px solid rgba(99, 102, 241, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .log-entry:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .log-entry.expanded {
            background: rgba(99, 102, 241, 0.08);
        }

        .log-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: var(--font-mono);
            font-size: 0.85rem;
        }

        .log-level {
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            min-width: 60px;
            text-align: center;
        }

        .log-level.INFO {
            background: rgba(6, 182, 212, 0.15);
            color: var(--accent-info);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        .log-level.WARNING {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .log-level.ERROR {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-error);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .log-level.DEBUG {
            background: rgba(139, 92, 246, 0.15);
            color: var(--accent-secondary);
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .log-timestamp {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .log-source {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .log-message {
            margin-top: 0.5rem;
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .log-context {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border-left: 3px solid var(--accent-primary);
        }

        .log-entry.expanded .log-context {
            display: block;
            animation: slideDown 0.2s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }

        .context-title {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .context-json {
            font-family: var(--font-mono);
            font-size: 0.85rem;
            color: var(--accent-info);
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* Loading & Empty States */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(99, 102, 241, 0.1);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            color: var(--accent-error);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            margin: 1rem 0;
            font-family: var(--font-mono);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .fleet-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }

            .vps-card.expanded .vps-details {
                grid-template-columns: 1fr;
            }

            #analytics-tab > div[style*="grid-template-columns"] {
                grid-template-columns: 1fr !important;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .fleet-grid {
                grid-template-columns: 1fr;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .control-row {
                flex-direction: column;
            }

            .tabs {
                overflow-x: auto;
            }

            .kpi-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .kpi-value {
                font-size: 2rem !important;
            }

            .apps-grid {
                grid-template-columns: 1fr !important;
            }
        }

        /* Chart Styling */
        canvas {
            max-height: 300px;
        }

        /* KPI Cards */
        .kpi-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            border-color: var(--border-glow);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .kpi-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.75rem;
            font-weight: 500;
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            font-family: var(--font-mono);
        }

        .kpi-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Recent Alerts */
        .recent-alerts {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            display: none;
        }

        .recent-alerts.has-alerts {
            display: block;
        }

        .alert-item {
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid var(--accent-error);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .alert-item:hover {
            background: rgba(239, 68, 68, 0.15);
        }

        .alert-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left-color: var(--accent-warning);
        }

        .alert-item.warning:hover {
            background: rgba(245, 158, 11, 0.15);
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .alert-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-family: var(--font-mono);
        }

        .alert-time {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        /* Applications Tab */
        .vps-section {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .vps-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .vps-section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .vps-section-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-family: var(--font-mono);
            margin-top: 0.25rem;
        }

        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1rem;
        }

        .app-card {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .app-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent-info);
            border-radius: 12px 0 0 12px;
            transition: width 0.3s ease;
        }

        .app-card.has-errors::before {
            background: var(--accent-error);
        }

        .app-card.has-warnings::before {
            background: var(--accent-warning);
        }

        .app-card:hover {
            border-color: var(--border-glow);
            background: rgba(20, 30, 50, 0.6);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .app-card:hover::before {
            width: 100%;
            opacity: 0.05;
        }

        .app-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .app-name-label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            font-family: var(--font-mono);
        }

        .app-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        .activity-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-success);
            box-shadow: 0 0 8px var(--glow-success);
            animation: pulse 2s ease-in-out infinite;
        }

        .activity-dot.inactive {
            background: var(--text-muted);
            box-shadow: none;
            animation: none;
        }

        .log-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .log-stat {
            text-align: center;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
        }

        .log-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            font-family: var(--font-mono);
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .log-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .log-stat.error .log-stat-value {
            color: var(--accent-error);
        }

        .log-stat.warning .log-stat-value {
            color: var(--accent-warning);
        }

        .log-stat.info .log-stat-value {
            color: var(--accent-info);
        }

        .log-stat.debug .log-stat-value {
            color: var(--accent-secondary);
        }

        .app-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-muted);
            font-family: var(--font-mono);
        }

        .last-log-time {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .view-logs-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--accent-primary);
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .view-logs-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: var(--accent-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš¡ Fleet Hub</h1>
            <div class="header-subtitle">
                <span>Real-time observability for deployed applications</span>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>SYSTEM ONLINE</span>
                </div>
            </div>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="showTab('fleet')">Fleet Overview</button>
            <button class="tab" onclick="showTab('apps')">Applications</button>
            <button class="tab" onclick="showTab('logs')">Log Stream</button>
            <button class="tab" onclick="showTab('analytics')">Analytics</button>
        </div>

        <!-- Fleet Tab -->
        <div id="fleet-tab" class="tab-content active">
            <!-- Fleet-wide KPIs -->
            <div class="kpi-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <div class="kpi-card">
                    <div class="kpi-label">Total Servers</div>
                    <div class="kpi-value" id="kpi-servers">-</div>
                    <div class="kpi-subtitle">Fleet instances</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Avg CPU Usage</div>
                    <div class="kpi-value" id="kpi-cpu">-</div>
                    <div class="kpi-subtitle">Across all servers</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Avg Memory</div>
                    <div class="kpi-value" id="kpi-memory">-</div>
                    <div class="kpi-subtitle">Across all servers</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Health Status</div>
                    <div class="kpi-value" id="kpi-health">-</div>
                    <div class="kpi-subtitle">Healthy instances</div>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div id="recent-alerts" class="recent-alerts" style="margin-bottom: 2rem;"></div>

            <div id="fleet-grid" class="fleet-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading fleet data...</div>
                </div>
            </div>
        </div>

        <!-- Applications Tab -->
        <div id="apps-tab" class="tab-content">
            <div id="apps-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading applications...</div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs-tab" class="tab-content">
            <div class="logs-controls">
                <div class="control-row">
                    <input type="text" class="search-box" id="log-search" placeholder="Search logs... (press Enter or wait 500ms)">
                    <button class="action-btn secondary-btn" onclick="exportLogs('json')">Export JSON</button>
                    <button class="action-btn secondary-btn" onclick="exportLogs('csv')">Export CSV</button>
                </div>
                <div class="control-row">
                    <div class="filter-group">
                        <button class="filter-btn active" data-level="ALL" onclick="filterByLevel('ALL')">ALL</button>
                        <button class="filter-btn" data-level="DEBUG" onclick="filterByLevel('DEBUG')">DEBUG</button>
                        <button class="filter-btn" data-level="INFO" onclick="filterByLevel('INFO')">INFO</button>
                        <button class="filter-btn" data-level="WARNING" onclick="filterByLevel('WARNING')">WARNING</button>
                        <button class="filter-btn" data-level="ERROR" onclick="filterByLevel('ERROR')">ERROR</button>
                    </div>
                    <select class="search-box" style="flex: 0 0 auto; width: 200px;" id="time-range" onchange="loadLogs()">
                        <option value="1">Last 1 hour</option>
                        <option value="6">Last 6 hours</option>
                        <option value="24" selected>Last 24 hours</option>
                        <option value="72">Last 3 days</option>
                        <option value="168">Last 7 days</option>
                    </select>
                </div>
            </div>

            <div id="logs-container" class="logs-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Loading logs...</div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <!-- Error Summary -->
            <div id="error-summary" class="chart-container" style="margin-bottom: 1.5rem;"></div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                <div class="chart-container">
                    <h2 class="chart-title">Log Volume by Level (Last 24h)</h2>
                    <canvas id="log-volume-chart"></canvas>
                </div>
                <div class="chart-container">
                    <h2 class="chart-title">Response Time Trend</h2>
                    <canvas id="response-time-chart"></canvas>
                </div>
            </div>
            <div class="chart-container">
                <h2 class="chart-title">Fleet Health Timeline</h2>
                <canvas id="health-timeline-chart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // State
        let expandedVPS = null;
        let currentLogLevel = 'ALL';
        let allLogs = [];
        let vpsCharts = {};

        // Chart.js default config
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.borderColor = 'rgba(99, 102, 241, 0.1)';
        Chart.defaults.font.family = "'JetBrains Mono', monospace";

        // Tab switching
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));

            // Find and activate the clicked tab
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabName.toLowerCase())) {
                    btn.classList.add('active');
                }
            });

            document.getElementById(tabName + '-tab').classList.add('active');

            if (tabName === 'logs') {
                loadLogs();
            } else if (tabName === 'analytics') {
                loadAnalytics();
            } else if (tabName === 'fleet') {
                loadFleetSummary();
            } else if (tabName === 'apps') {
                loadApplications();
            }
        }

        // Load fleet summary
        async function loadFleetSummary() {
            try {
                const response = await fetch('/api/fleet/summary');
                const data = await response.json();

                const container = document.getElementById('fleet-grid');

                if (data.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ðŸš€</div>
                            <h2>No VPS instances found</h2>
                            <p>Deploy an application to see monitoring data</p>
                        </div>
                    `;
                    return;
                }

                // Update KPIs
                updateKPIs(data);

                // Load recent alerts
                loadRecentAlerts();

                // Fetch logs to identify all apps per VPS
                const logsResponse = await fetch('/api/logs/recent?limit=1000');
                const logs = await logsResponse.json();

                // Group apps by VPS
                const vpsApps = {};
                logs.forEach(log => {
                    if (!vpsApps[log.vps_name]) {
                        vpsApps[log.vps_name] = new Set();
                    }
                    vpsApps[log.vps_name].add(log.app_name);
                });

                container.innerHTML = data.map((vps, idx) => {
                    const statusClass = vps.health_status === 'healthy' ? 'healthy' :
                                      vps.health_status === 'degraded' ? 'warning' : 'error';

                    // Get all apps for this VPS
                    const apps = vpsApps[vps.vps_name] ? Array.from(vpsApps[vps.vps_name]) : [vps.app_name];
                    const appBadges = apps.map(app =>
                        `<span class="app-badge" onclick="event.stopPropagation(); filterLogsByApp('${vps.vps_name}', '${app}')" title="Click to view logs">${app}</span>`
                    ).join('');

                    return `
                        <div class="vps-card ${statusClass}" id="vps-${idx}" onclick="toggleVPSCard(${idx}, '${vps.vps_name}')">
                            <div class="vps-header">
                                <div class="vps-title">
                                    <div class="vps-name">${vps.vps_name}</div>
                                    <div class="app-name">${appBadges}</div>
                                </div>
                                <div style="display: flex; gap: 0.5rem; align-items: center;">
                                    <button class="filter-btn" style="margin: 0; padding: 0.4rem 0.8rem;" onclick="event.stopPropagation(); filterLogsByVPS('${vps.vps_name}')" title="View logs">ðŸ“‹</button>
                                    <div class="status-badge ${statusClass}">${vps.health_status}</div>
                                </div>
                            </div>

                            <div class="metrics-grid">
                                <div class="metric">
                                    <div class="metric-label">CPU</div>
                                    <div class="metric-value">${vps.cpu_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                                    <div class="metric-bar">
                                        <div class="metric-bar-fill" style="width: ${vps.cpu_percent}%"></div>
                                    </div>
                                </div>
                                <div class="metric">
                                    <div class="metric-label">Memory</div>
                                    <div class="metric-value">${vps.memory_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                                    <div class="metric-bar">
                                        <div class="metric-bar-fill" style="width: ${vps.memory_percent}%"></div>
                                    </div>
                                </div>
                                <div class="metric">
                                    <div class="metric-label">Disk</div>
                                    <div class="metric-value">${vps.disk_percent.toFixed(1)}<span class="metric-unit">%</span></div>
                                    <div class="metric-bar">
                                        <div class="metric-bar-fill" style="width: ${vps.disk_percent}%"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="last-seen">Last seen: ${formatTimestamp(vps.last_seen)}</div>

                            <div class="vps-details" id="details-${idx}">
                                <div class="chart-container">
                                    <h3 class="chart-title">Metrics Timeline (24h)</h3>
                                    <canvas id="chart-${idx}"></canvas>
                                </div>
                                <div class="health-checks">
                                    <h3 class="chart-title">Recent Health Checks</h3>
                                    <div id="health-${idx}">Loading...</div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

            } catch (error) {
                document.getElementById('fleet-grid').innerHTML = `
                    <div class="error-message">Error loading fleet data: ${error.message}</div>
                `;
            }
        }

        // Toggle VPS card expansion
        async function toggleVPSCard(idx, vpsName) {
            const card = document.getElementById(`vps-${idx}`);
            const isExpanded = card.classList.contains('expanded');

            // Collapse all cards
            document.querySelectorAll('.vps-card').forEach(c => c.classList.remove('expanded'));

            if (!isExpanded) {
                card.classList.add('expanded');
                expandedVPS = idx;

                // Load detailed metrics
                await loadVPSMetrics(idx, vpsName);
                await loadVPSHealth(idx, vpsName);
            } else {
                expandedVPS = null;
            }
        }

        // Load VPS metrics chart
        async function loadVPSMetrics(idx, vpsName) {
            try {
                const response = await fetch(`/api/vps/${encodeURIComponent(vpsName)}/metrics?hours=24`);
                const data = await response.json();

                if (data.length === 0) return;

                const ctx = document.getElementById(`chart-${idx}`).getContext('2d');

                // Destroy existing chart
                if (vpsCharts[idx]) {
                    vpsCharts[idx].destroy();
                }

                vpsCharts[idx] = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => new Date(d.timestamp)),
                        datasets: [
                            {
                                label: 'CPU %',
                                data: data.map(d => d.cpu_percent),
                                borderColor: '#6366f1',
                                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Memory %',
                                data: data.map(d => d.memory_percent),
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Disk %',
                                data: data.map(d => d.disk_percent),
                                borderColor: '#06b6d4',
                                backgroundColor: 'rgba(6, 182, 212, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'hour',
                                    displayFormats: {
                                        hour: 'HH:mm'
                                    }
                                },
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                },
                                ticks: {
                                    callback: value => value + '%'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading metrics:', error);
            }
        }

        // Load VPS health checks
        async function loadVPSHealth(idx, vpsName) {
            try {
                const response = await fetch(`/api/vps/${encodeURIComponent(vpsName)}/health?hours=24`);
                const data = await response.json();

                const container = document.getElementById(`health-${idx}`);

                if (data.length === 0) {
                    container.innerHTML = '<p style="color: var(--text-muted);">No health checks recorded</p>';
                    return;
                }

                container.innerHTML = data.slice(0, 10).map(check => `
                    <div class="health-check-item ${check.success ? '' : 'failed'}">
                        <div class="health-check-time">${formatTimestamp(check.timestamp)}</div>
                        <div class="health-check-url">${check.url}</div>
                        <div class="health-check-status">
                            <span>${check.success ? 'âœ“ Success' : 'âœ— Failed'}</span>
                            <span>${check.status_code || 'N/A'} â€¢ ${check.response_time_ms ? check.response_time_ms.toFixed(0) + 'ms' : 'N/A'}</span>
                        </div>
                        ${check.error_message ? `<div style="color: var(--accent-error); margin-top: 0.25rem; font-size: 0.75rem;">${check.error_message}</div>` : ''}
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading health checks:', error);
            }
        }

        // Load logs
        async function loadLogs(query = '') {
            try {
                const timeRange = document.getElementById('time-range').value;
                const url = query
                    ? `/api/logs/search?query=${encodeURIComponent(query)}&hours=${timeRange}&limit=100`
                    : `/api/logs/recent?limit=100`;

                const response = await fetch(url);
                const data = await response.json();

                allLogs = data;
                renderLogs();
            } catch (error) {
                document.getElementById('logs-container').innerHTML = `
                    <div class="error-message">Error loading logs: ${error.message}</div>
                `;
            }
        }

        // Render logs with current filter
        function renderLogs() {
            const container = document.getElementById('logs-container');

            let filteredLogs = allLogs;
            if (currentLogLevel !== 'ALL') {
                filteredLogs = allLogs.filter(log => log.level === currentLogLevel);
            }

            if (filteredLogs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“</div>
                        <h2>No logs found</h2>
                        <p>Try adjusting your filters or time range</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredLogs.map((log, idx) => `
                <div class="log-entry" id="log-${idx}" onclick="toggleLogEntry(${idx})">
                    <div class="log-header">
                        <span class="log-level ${log.level}">${log.level}</span>
                        <span class="log-timestamp">${formatTimestamp(log.timestamp)}</span>
                        <span class="log-source">${log.vps_name}/${log.app_name}</span>
                    </div>
                    <div class="log-message">${escapeHtml(log.message)}</div>
                    ${log.context ? `
                        <div class="log-context">
                            <div class="context-title">Context Data</div>
                            <div class="context-json">${JSON.stringify(log.context, null, 2)}</div>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Toggle log entry expansion
        function toggleLogEntry(idx) {
            const entry = document.getElementById(`log-${idx}`);
            entry.classList.toggle('expanded');
        }

        // Filter logs by level
        function filterByLevel(level) {
            currentLogLevel = level;

            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.level === level);
            });

            renderLogs();
        }

        // Export logs
        function exportLogs(format) {
            let filteredLogs = allLogs;
            if (currentLogLevel !== 'ALL') {
                filteredLogs = allLogs.filter(log => log.level === currentLogLevel);
            }

            if (format === 'json') {
                const blob = new Blob([JSON.stringify(filteredLogs, null, 2)], { type: 'application/json' });
                downloadFile(blob, `logs-${Date.now()}.json`);
            } else if (format === 'csv') {
                const csv = logsToCSV(filteredLogs);
                const blob = new Blob([csv], { type: 'text/csv' });
                downloadFile(blob, `logs-${Date.now()}.csv`);
            }
        }

        // Convert logs to CSV
        function logsToCSV(logs) {
            const headers = ['Timestamp', 'VPS', 'App', 'Level', 'Message', 'Context'];
            const rows = logs.map(log => [
                log.timestamp,
                log.vps_name,
                log.app_name,
                log.level,
                log.message,
                log.context ? JSON.stringify(log.context) : ''
            ]);

            return [headers, ...rows]
                .map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
                .join('\n');
        }

        // Download file
        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Update KPIs
        function updateKPIs(fleetData) {
            const totalServers = fleetData.length;
            const healthyServers = fleetData.filter(v => v.health_status === 'healthy').length;
            const avgCPU = fleetData.reduce((sum, v) => sum + v.cpu_percent, 0) / totalServers;
            const avgMemory = fleetData.reduce((sum, v) => sum + v.memory_percent, 0) / totalServers;

            document.getElementById('kpi-servers').textContent = totalServers;
            document.getElementById('kpi-cpu').textContent = avgCPU.toFixed(1) + '%';
            document.getElementById('kpi-memory').textContent = avgMemory.toFixed(1) + '%';
            document.getElementById('kpi-health').textContent = `${healthyServers}/${totalServers}`;

            // Color code health
            const healthEl = document.getElementById('kpi-health');
            if (healthyServers === totalServers) {
                healthEl.parentElement.style.borderColor = 'var(--accent-success)';
            } else if (healthyServers / totalServers > 0.5) {
                healthEl.parentElement.style.borderColor = 'var(--accent-warning)';
            } else {
                healthEl.parentElement.style.borderColor = 'var(--accent-error)';
            }
        }

        // Load recent alerts
        async function loadRecentAlerts() {
            try {
                const response = await fetch('/api/logs/search?query=ERROR|WARNING&limit=5');
                const logs = await response.json();

                const container = document.getElementById('recent-alerts');

                if (logs.length === 0) {
                    container.classList.remove('has-alerts');
                    return;
                }

                container.classList.add('has-alerts');
                container.innerHTML = `
                    <h3 class="chart-title" style="margin-bottom: 1rem;">âš ï¸ Recent Alerts</h3>
                    ${logs.slice(0, 3).map(log => `
                        <div class="alert-item ${log.level === 'WARNING' ? 'warning' : ''}" onclick="showLogDetail('${log.timestamp}', '${log.vps_name}')">
                            <div class="alert-icon">${log.level === 'ERROR' ? 'ðŸ”´' : 'âš ï¸'}</div>
                            <div class="alert-content">
                                <div class="alert-title">${log.vps_name} / ${log.app_name}</div>
                                <div class="alert-message">${escapeHtml(log.message.substring(0, 100))}${log.message.length > 100 ? '...' : ''}</div>
                            </div>
                            <div class="alert-time">${formatTimestamp(log.timestamp)}</div>
                        </div>
                    `).join('')}
                `;
            } catch (error) {
                console.error('Error loading alerts:', error);
            }
        }

        // Filter logs by VPS
        async function filterLogsByVPS(vpsName) {
            showTab('logs');
            document.getElementById('log-search').value = vpsName;

            // Use the recent logs API with VPS filter
            try {
                const url = `/api/logs/recent?vps_name=${encodeURIComponent(vpsName)}&limit=100`;

                const response = await fetch(url);
                const data = await response.json();

                allLogs = data;
                renderLogs();
            } catch (error) {
                document.getElementById('logs-container').innerHTML = `
                    <div class="error-message">Error loading logs: ${error.message}</div>
                `;
            }
        }

        // Show log detail (jump to logs tab)
        function showLogDetail(timestamp, vpsName) {
            showTab('logs');
            document.getElementById('log-search').value = vpsName;
            loadLogs(vpsName);
        }

        // Load analytics
        async function loadAnalytics() {
            await Promise.all([
                loadLogVolumeChart(),
                loadResponseTimeChart(),
                loadHealthTimelineChart(),
                loadErrorSummary()
            ]);
        }

        // Load log volume chart
        async function loadLogVolumeChart() {
            try {
                // Get recent logs to calculate volumes
                const response = await fetch('/api/logs/recent?limit=1000');
                const logs = await response.json();

                // Group by hour and level
                const hourlyData = {};
                const levels = ['DEBUG', 'INFO', 'WARNING', 'ERROR'];

                logs.forEach(log => {
                    const hour = new Date(log.timestamp).setMinutes(0, 0, 0);
                    if (!hourlyData[hour]) {
                        hourlyData[hour] = { DEBUG: 0, INFO: 0, WARNING: 0, ERROR: 0 };
                    }
                    if (levels.includes(log.level)) {
                        hourlyData[hour][log.level]++;
                    }
                });

                const hours = Object.keys(hourlyData).sort().map(h => new Date(parseInt(h)));

                const ctx = document.getElementById('log-volume-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: hours,
                        datasets: [
                            {
                                label: 'DEBUG',
                                data: hours.map(h => hourlyData[h.getTime()].DEBUG),
                                backgroundColor: 'rgba(139, 92, 246, 0.6)',
                                borderColor: '#8b5cf6',
                                borderWidth: 1
                            },
                            {
                                label: 'INFO',
                                data: hours.map(h => hourlyData[h.getTime()].INFO),
                                backgroundColor: 'rgba(6, 182, 212, 0.6)',
                                borderColor: '#06b6d4',
                                borderWidth: 1
                            },
                            {
                                label: 'WARNING',
                                data: hours.map(h => hourlyData[h.getTime()].WARNING),
                                backgroundColor: 'rgba(245, 158, 11, 0.6)',
                                borderColor: '#f59e0b',
                                borderWidth: 1
                            },
                            {
                                label: 'ERROR',
                                data: hours.map(h => hourlyData[h.getTime()].ERROR),
                                backgroundColor: 'rgba(239, 68, 68, 0.6)',
                                borderColor: '#ef4444',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'hour',
                                    displayFormats: {
                                        hour: 'MMM d, HH:mm'
                                    }
                                },
                                stacked: true,
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                }
                            },
                            y: {
                                stacked: true,
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                },
                                ticks: {
                                    callback: value => Math.floor(value)
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading log volume chart:', error);
            }
        }

        // Load error summary
        async function loadErrorSummary() {
            try {
                const response = await fetch('/api/logs/recent?limit=1000');
                const logs = await response.json();

                const errors = logs.filter(l => l.level === 'ERROR');
                const warnings = logs.filter(l => l.level === 'WARNING');

                // Group errors by app
                const errorsByApp = {};
                errors.forEach(log => {
                    const key = `${log.vps_name}/${log.app_name}`;
                    errorsByApp[key] = (errorsByApp[key] || 0) + 1;
                });

                const topErrors = Object.entries(errorsByApp)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                const container = document.getElementById('error-summary');
                container.innerHTML = `
                    <h2 class="chart-title">ðŸ“Š Error Summary (Last 24h)</h2>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-top: 1rem;">
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; font-weight: 700; color: var(--accent-error);">${errors.length}</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Total Errors</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; font-weight: 700; color: var(--accent-warning);">${warnings.length}</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Total Warnings</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 3rem; font-weight: 700; color: var(--accent-info);">${((errors.length / logs.length) * 100).toFixed(1)}%</div>
                            <div style="color: var(--text-secondary); font-size: 0.9rem;">Error Rate</div>
                        </div>
                    </div>
                    ${topErrors.length > 0 ? `
                        <div style="margin-top: 1.5rem;">
                            <div style="font-weight: 600; margin-bottom: 0.75rem; color: var(--text-secondary);">Top Error Sources:</div>
                            ${topErrors.map(([app, count]) => `
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: rgba(239, 68, 68, 0.05); border-radius: 6px; margin-bottom: 0.5rem;">
                                    <span style="font-family: var(--font-mono); font-size: 0.85rem;">${app}</span>
                                    <span style="color: var(--accent-error); font-weight: 700;">${count} errors</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                `;
            } catch (error) {
                console.error('Error loading error summary:', error);
            }
        }

        // Load response time chart
        async function loadResponseTimeChart() {
            try {
                const summaryResponse = await fetch('/api/fleet/summary');
                const fleet = await summaryResponse.json();

                if (fleet.length === 0) return;

                // Load health data for all VPS
                const healthDataPromises = fleet.map(vps =>
                    fetch(`/api/vps/${encodeURIComponent(vps.vps_name)}/health?hours=24`)
                        .then(r => r.json())
                        .then(data => ({ vps: vps.vps_name, checks: data }))
                );

                const healthData = await Promise.all(healthDataPromises);

                // Calculate average response time per hour for each VPS
                const colors = [
                    { border: '#6366f1', bg: 'rgba(99, 102, 241, 0.1)' },
                    { border: '#8b5cf6', bg: 'rgba(139, 92, 246, 0.1)' },
                    { border: '#06b6d4', bg: 'rgba(6, 182, 212, 0.1)' },
                    { border: '#10b981', bg: 'rgba(16, 185, 129, 0.1)' }
                ];

                const datasets = healthData.map((vpsData, idx) => {
                    const color = colors[idx % colors.length];

                    const hourlyAvg = {};
                    vpsData.checks.forEach(check => {
                        if (check.response_time_ms) {
                            const hour = new Date(check.timestamp).setMinutes(0, 0, 0);
                            if (!hourlyAvg[hour]) {
                                hourlyAvg[hour] = { total: 0, count: 0 };
                            }
                            hourlyAvg[hour].total += check.response_time_ms;
                            hourlyAvg[hour].count++;
                        }
                    });

                    const dataPoints = Object.keys(hourlyAvg).sort().map(h => ({
                        x: new Date(parseInt(h)),
                        y: hourlyAvg[h].total / hourlyAvg[h].count
                    }));

                    return {
                        label: vpsData.vps,
                        data: dataPoints,
                        borderColor: color.border,
                        backgroundColor: color.bg,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 2
                    };
                });

                const ctx = document.getElementById('response-time-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: { datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'hour',
                                    displayFormats: {
                                        hour: 'HH:mm'
                                    }
                                },
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                },
                                ticks: {
                                    callback: value => value.toFixed(0) + 'ms'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}ms`;
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading response time chart:', error);
            }
        }

        // Load health timeline chart
        async function loadHealthTimelineChart() {
            try {
                // Get fleet summary to find all VPS instances
                const summaryResponse = await fetch('/api/fleet/summary');
                const fleet = await summaryResponse.json();

                if (fleet.length === 0) return;

                // Load health data for each VPS
                const healthDataPromises = fleet.map(vps =>
                    fetch(`/api/vps/${encodeURIComponent(vps.vps_name)}/health?hours=24`)
                        .then(r => r.json())
                        .then(data => ({ vps: vps.vps_name, checks: data }))
                );

                const healthData = await Promise.all(healthDataPromises);

                // Create datasets for each VPS (success rate over time)
                const colors = [
                    { border: '#6366f1', bg: 'rgba(99, 102, 241, 0.1)' },
                    { border: '#8b5cf6', bg: 'rgba(139, 92, 246, 0.1)' },
                    { border: '#06b6d4', bg: 'rgba(6, 182, 212, 0.1)' },
                    { border: '#10b981', bg: 'rgba(16, 185, 129, 0.1)' },
                    { border: '#f59e0b', bg: 'rgba(245, 158, 11, 0.1)' }
                ];

                const datasets = healthData.map((vpsData, idx) => {
                    const color = colors[idx % colors.length];

                    // Calculate success rate per hour
                    const hourlySuccess = {};
                    vpsData.checks.forEach(check => {
                        const hour = new Date(check.timestamp).setMinutes(0, 0, 0);
                        if (!hourlySuccess[hour]) {
                            hourlySuccess[hour] = { total: 0, success: 0 };
                        }
                        hourlySuccess[hour].total++;
                        if (check.success) hourlySuccess[hour].success++;
                    });

                    const dataPoints = Object.keys(hourlySuccess).sort().map(h => ({
                        x: new Date(parseInt(h)),
                        y: (hourlySuccess[h].success / hourlySuccess[h].total) * 100
                    }));

                    return {
                        label: vpsData.vps,
                        data: dataPoints,
                        borderColor: color.border,
                        backgroundColor: color.bg,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    };
                });

                const ctx = document.getElementById('health-timeline-chart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: { datasets },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'hour',
                                    displayFormats: {
                                        hour: 'HH:mm'
                                    }
                                },
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 100,
                                grid: {
                                    color: 'rgba(99, 102, 241, 0.05)'
                                },
                                ticks: {
                                    callback: value => value + '%'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}% uptime`;
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading health timeline chart:', error);
            }
        }

        // Load applications view
        async function loadApplications() {
            try {
                // Fetch recent logs to build application inventory
                const response = await fetch('/api/logs/recent?limit=1000');
                const logs = await response.json();

                const container = document.getElementById('apps-container');

                if (logs.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ðŸ“¦</div>
                            <h2>No applications found</h2>
                            <p>Start logging from your applications to see them here</p>
                        </div>
                    `;
                    return;
                }

                // Group logs by VPS and then by app
                const vpsList = {};

                logs.forEach(log => {
                    if (!vpsList[log.vps_name]) {
                        vpsList[log.vps_name] = {};
                    }
                    if (!vpsList[log.vps_name][log.app_name]) {
                        vpsList[log.vps_name][log.app_name] = {
                            logs: [],
                            errors: 0,
                            warnings: 0,
                            info: 0,
                            debug: 0,
                            lastLog: null
                        };
                    }

                    const appData = vpsList[log.vps_name][log.app_name];
                    appData.logs.push(log);

                    // Count by level
                    if (log.level === 'ERROR') appData.errors++;
                    else if (log.level === 'WARNING') appData.warnings++;
                    else if (log.level === 'INFO') appData.info++;
                    else if (log.level === 'DEBUG') appData.debug++;

                    // Track latest log
                    if (!appData.lastLog || new Date(log.timestamp) > new Date(appData.lastLog)) {
                        appData.lastLog = log.timestamp;
                    }
                });

                // Render VPS sections
                container.innerHTML = Object.entries(vpsList)
                    .sort((a, b) => a[0].localeCompare(b[0]))
                    .map(([vpsName, apps]) => {
                        const appCount = Object.keys(apps).length;
                        const totalLogs = Object.values(apps).reduce((sum, app) => sum + app.logs.length, 0);

                        return `
                            <div class="vps-section">
                                <div class="vps-section-header">
                                    <div>
                                        <div class="vps-section-title">ðŸ–¥ï¸ ${vpsName}</div>
                                        <div class="vps-section-subtitle">${appCount} application${appCount !== 1 ? 's' : ''} â€¢ ${totalLogs} logs</div>
                                    </div>
                                </div>
                                <div class="apps-grid">
                                    ${Object.entries(apps)
                                        .sort((a, b) => new Date(b[1].lastLog) - new Date(a[1].lastLog))
                                        .map(([appName, appData]) => {
                                            const hasErrors = appData.errors > 0;
                                            const hasWarnings = appData.warnings > 0;
                                            const isActive = new Date() - new Date(appData.lastLog) < 300000; // Active if logged in last 5 mins

                                            return `
                                                <div class="app-card ${hasErrors ? 'has-errors' : hasWarnings ? 'has-warnings' : ''}"
                                                     onclick="filterLogsByApp('${vpsName}', '${appName}')">
                                                    <div class="app-header">
                                                        <div class="app-name-label">${appName}</div>
                                                        <div class="app-status">
                                                            <div class="activity-dot ${isActive ? '' : 'inactive'}"></div>
                                                            ${isActive ? 'ACTIVE' : 'IDLE'}
                                                        </div>
                                                    </div>
                                                    <div class="log-stats">
                                                        <div class="log-stat error">
                                                            <div class="log-stat-value">${appData.errors}</div>
                                                            <div class="log-stat-label">Errors</div>
                                                        </div>
                                                        <div class="log-stat warning">
                                                            <div class="log-stat-value">${appData.warnings}</div>
                                                            <div class="log-stat-label">Warnings</div>
                                                        </div>
                                                        <div class="log-stat info">
                                                            <div class="log-stat-value">${appData.info}</div>
                                                            <div class="log-stat-label">Info</div>
                                                        </div>
                                                        <div class="log-stat debug">
                                                            <div class="log-stat-value">${appData.debug}</div>
                                                            <div class="log-stat-label">Debug</div>
                                                        </div>
                                                    </div>
                                                    <div class="app-meta">
                                                        <div class="last-log-time">
                                                            <span>Last log:</span>
                                                            <span style="color: var(--text-secondary);">${formatTimestamp(appData.lastLog)}</span>
                                                        </div>
                                                        <button class="view-logs-btn" onclick="event.stopPropagation(); filterLogsByApp('${vpsName}', '${appName}')">
                                                            View Logs â†’
                                                        </button>
                                                    </div>
                                                </div>
                                            `;
                                        }).join('')}
                                </div>
                            </div>
                        `;
                    }).join('');

            } catch (error) {
                document.getElementById('apps-container').innerHTML = `
                    <div class="error-message">Error loading applications: ${error.message}</div>
                `;
            }
        }

        // Filter logs by VPS and app
        async function filterLogsByApp(vpsName, appName) {
            showTab('logs');
            document.getElementById('log-search').value = `${vpsName} / ${appName}`;

            // Use the recent logs API with filters instead of search
            try {
                const timeRange = document.getElementById('time-range').value;
                const url = `/api/logs/recent?vps_name=${encodeURIComponent(vpsName)}&app_name=${encodeURIComponent(appName)}&limit=100`;

                const response = await fetch(url);
                const data = await response.json();

                allLogs = data;
                renderLogs();
            } catch (error) {
                document.getElementById('logs-container').innerHTML = `
                    <div class="error-message">Error loading logs: ${error.message}</div>
                `;
            }
        }

        // Search logs with debounce
        let searchTimeout;
        document.getElementById('log-search').addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const query = e.target.value.trim();
                if (query.length === 0) {
                    loadLogs();
                } else {
                    loadLogs(query);
                }
            }, 500);
        });

        document.getElementById('log-search').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();
                if (query.length === 0) {
                    loadLogs();
                } else {
                    loadLogs(query);
                }
            }
        });

        // Utility functions
        function formatTimestamp(ts) {
            const date = new Date(ts);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;
            if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;

            return date.toLocaleString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Auto-refresh fleet summary every 30 seconds
        setInterval(loadFleetSummary, 30000);

        // Initial load
        loadFleetSummary();
    </script>
</body>
</html>
